<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <title>Saldo Fácil</title>
  <!-- Google Tag Manager e outros metadados... -->
  <script>(function (w, d, s, l, i) {
      w[l] = w[l] || []; w[l].push({
        'gtm.start':
          new Date().getTime(), event: 'gtm.js'
      }); var f = d.getElementsByTagName(s)[0],
        j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src =
          'https://www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f);
    })(window, document, 'script', 'dataLayer', 'GTM-54RF6LLM');</script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" href="favicon.ico">
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="style-index.css">
</head>

<body>
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-54RF6LLM" height="0" width="0"
      style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  <div class="navigation">
    <div class="nav-wrapper">
      <span class="brand-logo center">Saldo Fácil</span>
    </div>
  </div>

  <div class="main-content">
    <div class="container">
      <!-- Card do Usuário -->
      <div class="card user-card">
        <div class="card-content">
          <h5 id="user-name" class="user-greeting"></h5>
          <div class="user-actions">
            <div class="input-field year-selector-wrapper">
              <label for="yearSelector">Ano de Referência</label>
              <select id="yearSelector"></select>
            </div>
            <div class="user-buttons">
              <button onclick="logout()" class="btn-user-action">
                <i class="material-icons">exit_to_app</i> Logout
              </button>
              <button onclick="deleteAccount()" class="btn-user-action red">
                <i class="material-icons">delete_forever</i> Excluir Conta
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Seção de Controle Mensal -->
      <h4 class="section-title">Controle Mensal</h4>
      <div class="dashboard-grid">
        <!-- Verão -->
        <div class="card nav-card" id="card1">
          <div class="card-content"><i class="material-icons">wb_sunny</i><span class="card-title">Janeiro</span></div>
        </div>
        <div class="card nav-card" id="card2">
          <div class="card-content"><i class="material-icons">wb_sunny</i><span class="card-title">Fevereiro</span>
          </div>
        </div>
        <div class="card nav-card" id="card12">
          <div class="card-content"><i class="material-icons">wb_sunny</i><span class="card-title">Dezembro</span></div>
        </div>

        <!-- Outono -->
        <div class="card nav-card" id="card3">
          <div class="card-content"><i class="material-icons">eco</i><span class="card-title">Março</span></div>
        </div>
        <div class="card nav-card" id="card4">
          <div class="card-content"><i class="material-icons">park</i><span class="card-title">Abril</span></div>
        </div>
        <div class="card nav-card" id="card5">
          <div class="card-content"><i class="material-icons">forest</i><span class="card-title">Maio</span></div>
        </div>

        <!-- Inverno -->
        <div class="card nav-card" id="card6">
          <div class="card-content"><i class="material-icons">ac_unit</i><span class="card-title">Junho</span></div>
        </div>
        <div class="card nav-card" id="card7">
          <div class="card-content"><i class="material-icons">cloud</i><span class="card-title">Julho</span></div>
        </div>
        <div class="card nav-card" id="card8">
          <div class="card-content"><i class="material-icons">nightlight</i><span class="card-title">Agosto</span></div>
        </div>

        <!-- Primavera -->
        <div class="card nav-card" id="card9">
          <div class="card-content"><i class="material-icons">local_florist</i><span class="card-title">Setembro</span>
          </div>
        </div>
        <div class="card nav-card" id="card10">
          <div class="card-content"><i class="material-icons">grass</i><span class="card-title">Outubro</span></div>
        </div>
        <div class="card nav-card" id="card11">
          <div class="card-content"><i class="material-icons">landscape</i><span class="card-title">Novembro</span>
          </div>
        </div>
      </div>


      <!-- Seção de Ferramentas e Relatórios -->
      <h4 class="section-title">Ferramentas e Relatórios</h4>
      <div class="dashboard-grid">
        <div class="card nav-card" id="card13">
          <div class="card-content"><i class="material-icons">credit_card</i><span class="card-title">Cartão de
              Crédito</span></div>
        </div>
        <div class="card nav-card" id="card22">
          <div class="card-content"><i class="material-icons">trending_up</i><span
              class="card-title">Investimentos</span></div>
        </div>
        <div class="card nav-card" id="card17">
          <div class="card-content"><i class="material-icons">favorite</i><span class="card-title">Dízimos</span></div>
        </div>
        <div class="card nav-card" id="card18">
          <div class="card-content"><i class="material-icons">assessment</i><span class="card-title">Relatório
              Anual</span></div>
        </div>
        <div class="card nav-card" id="card19">
          <div class="card-content"><i class="material-icons">bar_chart</i><span class="card-title">Gráficos</span>
          </div>
        </div>
        <div class="card nav-card" id="card20">
          <div class="card-content"><i class="material-icons">psychology</i><span class="card-title">Assistente
              IA</span></div>
        </div>
        <div class="card nav-card" id="card16">
          <div class="card-content"><i class="material-icons">construction</i><span
              class="card-title">Ferramentas</span></div>
        </div>
        <div class="card nav-card" id="card23">
          <div class="card-content"><i class="material-icons">calculate</i><span class="card-title">Salário
              Líquido</span></div>
        </div>
        <div class="card nav-card" id="card14">
          <div class="card-content"><i class="material-icons">help_outline</i><span class="card-title">FAQ</span></div>
        </div>
        <div class="card nav-card" id="card15">
          <div class="card-content"><i class="material-icons">privacy_tip</i><span class="card-title">Privacidade</span>
          </div>
        </div>
        <div class="card nav-card" id="card21">
          <div class="card-content"><i class="material-icons">chat</i><span class="card-title">Chat ao Vivo</span></div>
        </div>
        <div class="card nav-card" id="limparDadosCard">
          <div class="card-content"><i class="material-icons">autorenew</i><span class="card-title">Recomeçar</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <footer class="page-footer">
    <div class="container">
      <p class="custom-flow-text">
        "O sucesso é a soma de pequenos esforços repetidos diariamente" - Robert Collier
      </p>
      <div class="divider"></div>
      <p class="grey-text text-lighten-4">
        © 2024 Saldo Fácil. Todos os direitos reservados.
      </p><br>
    </div>
  </footer>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

  <script type="module">
    // Importa os módulos necessários do Firebase
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js';
    import { getAuth, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/9.0.0/firebase-auth.js';
    import { getDatabase, ref, remove } from 'https://www.gstatic.com/firebasejs/9.0.0/firebase-database.js';
    import firebaseConfig from './config.js';

    // Inicializa o Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const database = getDatabase(app);

    // Função para navegar para a página correta com o ano SELECIONADO
    function navigateTo(page) {
      const year = localStorage.getItem('selectedYear') || new Date().getFullYear();
      if (page) {
        window.location.href = `${page}?year=${year}`;
      }
    }

    // Gera as opções de ano e seleciona o ano salvo no localStorage
    function setupYearSelector() {
      const yearSelector = document.getElementById("yearSelector");
      const startYear = 2020;
      const endYear = 2030;

      let savedYear = localStorage.getItem('selectedYear');
      const currentYear = savedYear ? parseInt(savedYear) : new Date().getFullYear();

      yearSelector.innerHTML = '';

      for (let year = startYear; year <= endYear; year++) {
        const option = document.createElement("option");
        option.value = year;
        option.text = year;
        yearSelector.add(option);
      }

      yearSelector.value = currentYear;
      M.FormSelect.init(yearSelector); // Inicializa o componente Materialize

      yearSelector.addEventListener('change', function () {
        localStorage.setItem('selectedYear', this.value);
      });
    }

    // Função de logout
    window.logout = function () {
      signOut(auth).then(() => {
        window.location.href = "login.html";
      }).catch((error) => console.error("Erro ao fazer logout: ", error));
    };

    // Função de excluir conta
    window.deleteAccount = function () {
      window.location.href = "delete_account.html";
    };

    // Função para limpar todos os dados do usuário
    function limparDados() {
      if (confirm("Tem certeza que deseja limpar TODOS os dados de TODOS os anos? Esta ação é irreversível.")) {
        const userId = auth.currentUser ? auth.currentUser.uid : null;
        if (userId) {
          const userRootRef = ref(database, 'users/' + userId);
          const creditCardRootRef = ref(database, 'creditCardData/' + userId);
          const creditCardBalancesRootRef = ref(database, 'creditCardBalances/' + userId);
          const investimentsRootRef = ref(database, 'investimentsData/' + userId);

          Promise.all([
            remove(userRootRef),
            remove(creditCardRootRef),
            remove(creditCardBalancesRootRef),
            remove(investimentsRootRef)
          ]).then(() => {
            alert("Todos os seus dados foram apagados permanentemente.");
            localStorage.clear();
          }).catch((error) => console.error("Erro ao apagar dados do Firebase: ", error));
        } else {
          alert("Usuário não autenticado.");
        }
      }
    }

    // Event listener principal
    document.addEventListener("DOMContentLoaded", () => {
      onAuthStateChanged(auth, (user) => {
        if (user) {
          const displayName = user.displayName || user.email;
          document.getElementById('user-name').innerHTML = `<b>Olá,</b><br><br>${displayName}!`;
          setupYearSelector(); // Chama a configuração do seletor
        } else {
          window.location.href = "login.html";
        }
      });

      // Adiciona os event listeners aos cards
      document.getElementById("limparDadosCard").addEventListener("click", limparDados);

      const cardMappings = {
        "card1": "1Jan.html", "card2": "2Fev.html", "card3": "3Mar.html",
        "card4": "4Abr.html", "card5": "5Mai.html", "card6": "6Jun.html",
        "card7": "7Jul.html", "card8": "8Ago.html", "card9": "9Set.html",
        "card10": "10Out.html", "card11": "11Nov.html", "card12": "12Dez.html",
        "card13": "cartao_de_credito.html", "card17": "dizimo.html",
        "card18": "relatorio.html", "card19": "chart.html",
        "card20": "iareports.html", "card22": "investimentos.html"
      };

      for (const [id, page] of Object.entries(cardMappings)) {
        document.getElementById(id).addEventListener("click", () => navigateTo(page));
      }

      // Links estáticos
      document.getElementById("card14").addEventListener("click", () => window.location.href = "perguntas_frequentes.html");
      document.getElementById("card15").addEventListener("click", () => window.location.href = "privacy.html");
      document.getElementById("card16").addEventListener("click", () => window.location.href = "ferramentas.html");
      document.getElementById("card21").addEventListener("click", () => window.location.href = "chat.html");
      document.getElementById("card23").addEventListener("click", () => window.location.href = "ordenado.html");
    });
  </script>
</body>

</html>